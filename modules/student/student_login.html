<!-- student_login.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EducAid Login - General Trias City</title>
  <link href="../../assets/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link rel="stylesheet" href="../../assets/css/preloader.css" />
  <link rel="stylesheet" href="../../assets/css/student/student_login.css" />
</head>
<body>
  <!-- Preloader -->
  <div id="preloader">
    <img src="../../assets/images/logo.png" class="preloader-logo" />
  </div>

  <div class="login-wrapper">
    <div class="login-container">
      <!-- Left Side - Branding -->
      <div class="login-left">
        <div class="brand-section">
          <div class="brand-logo">
            <i class="bi bi-mortarboard-fill fs-1 text-primary"></i>
          </div>
          <h3 class="fw-bold mb-2">EducAid</h3>
          <h6 class="mb-3">General Trias City</h6>
          <p class="mb-4">Your gateway to simplified scholarship services</p>
          <div class="d-flex justify-content-center gap-4 mt-4">
            <div class="text-center">
              <i class="bi bi-shield-check fs-4 mb-2"></i>
              <p class="small mb-0">Secure</p>
            </div>
            <div class="text-center">
              <i class="bi bi-lightning-fill fs-4 mb-2"></i>
              <p class="small mb-0">Fast</p>
            </div>
            <div class="text-center">
              <i class="bi bi-people-fill fs-4 mb-2"></i>
              <p class="small mb-0">Trusted</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Right Side - Login Form -->
      <div class="login-right">
        <div class="login-header">
          <h4 class="fw-bold text-dark mb-2">Welcome Back!</h4>
          <p class="text-muted">Please sign in to your account</p>
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="form" autocomplete="off" novalidate>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="firstname" class="form-label">First Name</label>
              <input type="text" id="firstname" name="firstname"
                     class="form-control"
                     autocomplete="given-name"
                     placeholder="Enter first name"
                     required />
            </div>
            <div class="col-md-6 mb-3">
              <label for="lastname" class="form-label">Last Name</label>
              <input type="text" id="lastname" name="lastname"
                     class="form-control"
                     autocomplete="family-name"
                     placeholder="Enter last name"
                     required />
            </div>
          </div>
          
          <div class="mb-3">
            <label for="email" class="form-label">Email Address</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-envelope text-muted"></i>
              </span>
              <input type="email" id="email" name="email"
                     class="form-control"
                     autocomplete="email"
                     placeholder="Enter your email"
                     required />
            </div>
          </div>
          
          <div class="mb-3">
            <label for="password" class="form-label">Password</label>
            <div class="input-group">
              <span class="input-group-text">
                <i class="bi bi-lock text-muted"></i>
              </span>
              <input type="password" id="password" name="password"
                     class="form-control"
                     autocomplete="current-password"
                     placeholder="Enter your password"
                     required />
              <span class="input-group-text toggle-password">
                <i class="bi bi-eye text-muted" id="toggleIcon"></i>
              </span>
            </div>
          </div>
          
          <div class="d-flex justify-content-between align-items-center mb-4">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="rememberMe" autocomplete="off" />
              <label class="form-check-label text-muted" for="rememberMe">Remember me</label>
            </div>
            <a href="#" id="forgotPassBtn" class="text-decoration-none fw-medium" style="color: var(--trias-blue);">
              Forgot Password?
            </a>
          </div>
          
          <button type="submit" class="btn btn-login text-white w-100 mb-3">
            <i class="bi bi-box-arrow-in-right me-2"></i>Sign In
          </button>
        </form>

        <!-- Quick Links -->
        <div class="quick-links">
          <p class="mb-2 text-muted fw-medium">Don't have an account?</p>
          <a href="student_register.php" class="btn btn-outline-primary">
            <i class="bi bi-person-plus me-1"></i>Create New Account
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Login-OTP Modal -->
  <div class="modal fade" id="loginOtpModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg">
        <div class="modal-header text-white" style="background: var(--trias-blue);">
          <h5 class="modal-title">
            <i class="bi bi-shield-check me-2"></i>OTP Verification
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="text-center mb-4">
            <div class="d-inline-flex p-3 mb-3 rounded-circle" style="background: rgba(59, 130, 246, 0.1);">
              <i class="bi bi-envelope-check fs-3" style="color: var(--trias-blue);"></i>
            </div>
            <h6>We've sent a verification code to your email</h6>
            <p class="text-muted mb-0">Please enter the 6-digit code to continue</p>
          </div>
          
          <div class="mb-3">
            <label for="loginOtpInput" class="form-label fw-medium">Verification Code</label>
            <input type="text" id="loginOtpInput"
                   class="form-control text-center fs-4 letter-spacing-3"
                   maxlength="6"
                   autocomplete="one-time-code"
                   placeholder="000000" />
          </div>
          <div class="form-text text-danger" id="loginOtpStatus"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn text-white" style="background: var(--trias-blue);" id="loginVerifyOtpBtn">
            <i class="bi bi-check-circle me-2"></i>Verify Code
          </button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Forgot-Password Modal -->
  <div class="modal fade" id="forgotPassModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <form id="forgotPassForm" class="modal-content border-0 shadow-lg" autocomplete="off" novalidate>
        <div class="modal-header text-white" style="background: var(--trias-gold);">
          <h5 class="modal-title">
            <i class="bi bi-key me-2"></i>Reset Password
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="text-center mb-4">
            <div class="d-inline-flex p-3 mb-3 rounded-circle" style="background: rgba(245, 158, 11, 0.1);">
              <i class="bi bi-arrow-clockwise fs-3" style="color: var(--trias-gold);"></i>
            </div>
            <h6>Forgot your password?</h6>
            <p class="text-muted mb-0">No worries! We'll help you reset it</p>
          </div>
          
          <div class="mb-3">
            <label for="forgotEmail" class="form-label fw-medium">Email Address</label>
            <input type="email" id="forgotEmail"
                   class="form-control"
                   autocomplete="email"
                   placeholder="Enter your email address"
                   required />
          </div>
          
          <div class="mb-3" id="otpSection" style="display:none;">
            <label for="otpInput" class="form-label fw-medium">Verification Code</label>
            <input type="text" id="otpInput"
                   class="form-control text-center"
                   maxlength="6"
                   autocomplete="one-time-code"
                   placeholder="Enter 6-digit code" />
          </div>
          
          <div class="mb-3" id="newPasswordSection" style="display:none;">
            <label for="newPassword" class="form-label fw-medium">New Password</label>
            <input type="password" id="newPassword"
                   class="form-control"
                   minlength="12"
                   autocomplete="new-password"
                   placeholder="Enter new password (min 12 characters)" />
          </div>
          
          <div class="form-text text-danger" id="forgotPassStatus"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-primary" id="sendOtpBtn">
            <i class="bi bi-envelope me-2"></i>Send OTP
          </button>
          <button type="button" class="btn btn-primary" id="verifyOtpBtn" style="display:none;">
            <i class="bi bi-check-circle me-2"></i>Verify OTP
          </button>
          <button type="button" class="btn btn-success" id="resetPasswordBtn" style="display:none;">
            <i class="bi bi-arrow-repeat me-2"></i>Reset Password
          </button>
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </form>
    </div>
  </div>

  <script src="../../assets/js/bootstrap.bundle.min.js"></script>
  <script src="../../assets/js/preloader.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // Toggle password visibility
      document.querySelector(".toggle-password").addEventListener("click", () => {
        const pwd = document.getElementById("password"), icon = document.getElementById("toggleIcon");
        pwd.type = pwd.type === "password" ? "text" : "password";
        icon.classList.toggle("bi-eye");
        icon.classList.toggle("bi-eye-slash");
      });

      // LOGIN PHASE 1: credentials → send login-OTP
      const loginForm = document.getElementById("loginForm");
      loginForm.addEventListener("submit", e => {
        e.preventDefault();
        const data = new URLSearchParams(new FormData(loginForm));
        fetch("student_login.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: data
        })
        .then(res => res.json())
        .then(json => {
          if (json.status === "otp_sent") {
            new bootstrap.Modal(document.getElementById("loginOtpModal")).show();
          } else {
            alert(json.message);
          }
        })
        .catch(() => alert("Server error — please try again."));
      });

      // LOGIN PHASE 2: verify login-OTP
      document.getElementById("loginVerifyOtpBtn").addEventListener("click", () => {
        const otp = document.getElementById("loginOtpInput").value.trim();
        fetch("student_login.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            login_action: "verify_otp",
            login_otp: otp
          })
        })
        .then(res => res.json())
        .then(json => {
          const statusEl = document.getElementById("loginOtpStatus");
          statusEl.textContent = json.message;
          if (json.status === "success") {
            window.location.href = json.redirect;
          }
        })
        .catch(() => alert("Server error — please try again."));
      });

      // FORGOT-PASSWORD OTP FLOW
      document.getElementById("forgotPassBtn").addEventListener("click", e => {
        e.preventDefault();
        new bootstrap.Modal(document.getElementById("forgotPassModal")).show();
      });
      
      const forgotEmail = document.getElementById("forgotEmail"),
            sendOtpBtn = document.getElementById("sendOtpBtn"),
            verifyOtpBtn = document.getElementById("verifyOtpBtn"),
            resetPasswordBtn = document.getElementById("resetPasswordBtn"),
            otpSection = document.getElementById("otpSection"),
            newPasswordSection = document.getElementById("newPasswordSection"),
            forgotPassStatus = document.getElementById("forgotPassStatus"),
            otpInput = document.getElementById("otpInput"),
            newPassword = document.getElementById("newPassword");

      sendOtpBtn.addEventListener("click", () => {
        fetch("student_login.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            forgot_action: "send_otp",
            forgot_email: forgotEmail.value.trim()
          })
        })
        .then(res => res.json())
        .then(data => {
          forgotPassStatus.textContent = data.message;
          if (data.status === "success") {
            otpSection.style.display = "block";
            verifyOtpBtn.style.display = "inline-block";
            sendOtpBtn.style.display = "none";
          }
        })
        .catch(() => forgotPassStatus.textContent = "Server error, try again.");
      });

      verifyOtpBtn.addEventListener("click", () => {
        fetch("student_login.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            forgot_action: "verify_otp",
            forgot_otp: otpInput.value.trim()
          })
        })
        .then(res => res.json())
        .then(data => {
          forgotPassStatus.textContent = data.message;
          if (data.status === "success") {
            newPasswordSection.style.display = "block";
            resetPasswordBtn.style.display = "inline-block";
            verifyOtpBtn.style.display = "none";
          }
        })
        .catch(() => forgotPassStatus.textContent = "Server error, try again.");
      });

      resetPasswordBtn.addEventListener("click", () => {
        fetch("student_login.php", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams({
            forgot_action: "set_new_password",
            forgot_new_password: newPassword.value
          })
        })
        .then(res => res.json())
        .then(data => {
          forgotPassStatus.textContent = data.message;
          if (data.status === "success") {
            setTimeout(() => location.reload(), 1500);
          }
        })
        .catch(() => forgotPassStatus.textContent = "Server error, try again.");
      });
    });
  </script>
</body>
</html>
